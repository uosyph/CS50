{% extends "auctions/layout.html" %}

{% block body %}
{%if message%}
<div class="container">
    {%if updated%}
        <div class="alert alert-success" role="alert">
            {{message}}
        </div>
    {%else%}
        <div class="alert alert-danger" role="alert">
            {{message}}
        </div>
    {%endif%}
</div>
{%endif%}

{%if not listing.isActive and user == listing.price.user%}
<div class="container">
    <div class="alert alert-success" role="alert">
        Congrats! You Won The Auction.
    </div>
</div>
{%endif%}

<h2>{{listing.title}}</h2>
<p>{{listing.desc}}</p>
<img src="{{listing.img}}" alt="{{listing.title}}" width="450px">
<h5>{{listing.owner}}</h5>
<h4><sup>$</sup>{{listing.price.bid}}</h4>

<div class="row">
    {%if user.is_authenticated and listing.isActive%}
        {%if isOwner%}
            <form action="{%url 'endAuction' id=listing.id%}" method="POST" class="mx-3">
                {%csrf_token%}
                <button type="submit" class="btn btn-outline-warning">End Auction</button>
            </form>            
        {%endif%}
        {%if isInWatchlist%}
            <form action="{%url 'removeFromWatchlist' id=listing.id%}" method="POST" class="mx-3">
                {%csrf_token%}
                <button type="submit" class="btn btn-outline-warning">Remove from Watchlist</button>
            </form>
        {%else%}
            <form action="{%url 'addToWatchlist' id=listing.id%}" method="POST" class="mx-3">
                {%csrf_token%}
                <button type="submit" class="btn btn-outline-success">Add to Watchlist</button>
            </form>
        {%endif%}
    {%endif%}
</div>

{%if user.is_authenticated%}
<br>
<form action="{%url 'addBid' id=listing.id%}" method="POST">
    {%csrf_token%}
    <div class="form-group">
        <label for="newBid">Add a Bid</label>
        <input type="number" min="0" name="newBid">
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary">Add</button>
    </div>
</form>
{%endif%}

<div class="comments">
    <br>
    <h4>Comments</h4>
    <br>
    {%if user.is_authenticated%}
    <form action="{%url 'addComment' id=listing.id%}" method="POST">
        {%csrf_token%}
        <div class="form-group">
            <label for="newComment">Add a Comment</label>
            <input type="text" name="newComment">
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-success">Add</button>
        </div>
    </form>
    {%endif%}
    <br>
    
    <ul class="list-group">
        {%for comment in comments%}
            <li class="list-group-item">
                <p><b>Author:</b> {{comment.author}}</p>
                <p><b>Comment:</b> {{comment.comment}}</p>
                <br>
            </li>
        {%endfor%}
    </ul>
</div>
{% endblock %}